<!DOCTYPE HTML>
<html lang="en-US" manifest="../../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Memory Management and Pointers | Rust to MapReduce</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="rtm9zc">
        <meta name="description" content="RustLogoWelcome to Rust to MapReduce!">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../../md/02/2.html" />
        
        
        <link rel="prev" href="../../md/02.html" />
        

        <meta property="og:title" content="Memory Management and Pointers | Rust to MapReduce">
        <meta property="og:site_name" content="Rust to MapReduce">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/rtm9zc">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="../../gitbook/style.css">
        


        
    <div class="book" data-github="rtm9zc/Rust-Pages" data-level="2.1" data-basepath="../.." data-revision="1402080426539">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/rtm9zc/Rust-Pages" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/rtm9zc/Rust-Pages/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/rtm9zc/Rust-Pages/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../../" >Rust to MapReduce</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/rtm9zc" target="blank" class="author-link">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/rtm9zc/Rust-Pages/issues" target="blank"class="issues-link">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/rtm9zc/Rust-Pages/edit/master/md/02/1.md" target="blank" class="contribute-link">Edit and Contribute</a>
        </li>
        

        

        <li data-level="0" data-path="index.html">
            <a href="../../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li class="chapter " data-level="1" data-path="md/01.html">
                
                <a href="../../md/01.html">
                    <i class="fa fa-check"></i> <b>1.</b> Getting Started: Variables, Functions, and Syntax
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="md/01/1.html">
                            
                            <a href="../../md/01/1.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> Variables
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="md/01/2.html">
                            
                            <a href="../../md/01/2.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> Conditionals
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="md/01/3.html">
                            
                            <a href="../../md/01/3.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> Pattern Matching
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.4" data-path="md/01/4.html">
                            
                            <a href="../../md/01/4.html">
                                <i class="fa fa-check"></i> <b>1.4.</b> Looping
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.5" data-path="md/01/5.html">
                            
                            <a href="../../md/01/5.html">
                                <i class="fa fa-check"></i> <b>1.5.</b> Expressions
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.6" data-path="md/01/6.html">
                            
                            <a href="../../md/01/6.html">
                                <i class="fa fa-check"></i> <b>1.6.</b> Functions
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.7" data-path="md/01/7.html">
                            
                            <a href="../../md/01/7.html">
                                <i class="fa fa-check"></i> <b>1.7.</b> Program 1: Collatz
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="2" data-path="md/02.html">
                
                <a href="../../md/02.html">
                    <i class="fa fa-check"></i> <b>2.</b> Starting to Corrode: Pointers, Memory, Strings, and I/O
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="md/02/1.html">
                            
                            <a href="../../md/02/1.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Memory Management and Pointers
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="md/02/2.html">
                            
                            <a href="../../md/02/2.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> Vectors and Strings
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="md/02/3.html">
                            
                            <a href="../../md/02/3.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> Error Handling
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="md/02/4.html">
                            
                            <a href="../../md/02/4.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Basic I/O
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="md/02/5.html">
                            
                            <a href="../../md/02/5.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Example: Secret Sharing
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="3" data-path="md/03.html">
                
                <a href="../../md/03.html">
                    <i class="fa fa-check"></i> <b>3.</b> Multi-Purpose Maps: Structures, Traits, and Higher-Order Functions
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="md/03/1.html">
                            
                            <a href="../../md/03/1.html">
                                <i class="fa fa-check"></i> <b>3.1.</b> Structures
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="md/03/2.html">
                            
                            <a href="../../md/03/2.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> Traits
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="md/03/3.html">
                            
                            <a href="../../md/03/3.html">
                                <i class="fa fa-check"></i> <b>3.3.</b> Higher-Order Functions
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="md/03/4.html">
                            
                            <a href="../../md/03/4.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> Example: Mapping a List
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="4" data-path="md/04.html">
                
                <a href="../../md/04.html">
                    <i class="fa fa-check"></i> <b>4.</b> Tasks and Communication
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="md/04/1.html">
                            
                            <a href="../../md/04/1.html">
                                <i class="fa fa-check"></i> <b>4.1.</b> Task Properties
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="md/04/2.html">
                            
                            <a href="../../md/04/2.html">
                                <i class="fa fa-check"></i> <b>4.2.</b> Example: Multi-Tasking Map
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="5" data-path="md/05.html">
                
                <a href="../../md/05.html">
                    <i class="fa fa-check"></i> <b>5.</b> Concurrency Across Tasks: Arcs and Mutexes
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="md/05/1.html">
                            
                            <a href="../../md/05/1.html">
                                <i class="fa fa-check"></i> <b>5.1.</b> The Arc Module
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2" data-path="md/05/2.html">
                            
                            <a href="../../md/05/2.html">
                                <i class="fa fa-check"></i> <b>5.2.</b> Using a Mutex
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="6" data-path="md/06.html">
                
                <a href="../../md/06.html">
                    <i class="fa fa-check"></i> <b>6.</b> Bringing It Together: MapReduce in Rust
                </a>
                
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 38.46153846153846%;min-width: 34.61538461538461%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../../md/01.html" title="Getting Started: Variables, Functions, and Syntax" class="chapter done new-chapter" data-progress="1" style="left: 3.8461538461538463%;"></a>
    
        <a href="../../md/01/1.html" title="Variables" class="chapter done " data-progress="1.1" style="left: 7.6923076923076925%;"></a>
    
        <a href="../../md/01/2.html" title="Conditionals" class="chapter done " data-progress="1.2" style="left: 11.538461538461538%;"></a>
    
        <a href="../../md/01/3.html" title="Pattern Matching" class="chapter done " data-progress="1.3" style="left: 15.384615384615385%;"></a>
    
        <a href="../../md/01/4.html" title="Looping" class="chapter done " data-progress="1.4" style="left: 19.23076923076923%;"></a>
    
        <a href="../../md/01/5.html" title="Expressions" class="chapter done " data-progress="1.5" style="left: 23.076923076923077%;"></a>
    
        <a href="../../md/01/6.html" title="Functions" class="chapter done " data-progress="1.6" style="left: 26.923076923076923%;"></a>
    
        <a href="../../md/01/7.html" title="Program 1: Collatz" class="chapter done " data-progress="1.7" style="left: 30.76923076923077%;"></a>
    
        <a href="../../md/02.html" title="Starting to Corrode: Pointers, Memory, Strings, and I/O" class="chapter done new-chapter" data-progress="2" style="left: 34.61538461538461%;"></a>
    
        <a href="../../md/02/1.html" title="Memory Management and Pointers" class="chapter done " data-progress="2.1" style="left: 38.46153846153846%;"></a>
    
        <a href="../../md/02/2.html" title="Vectors and Strings" class="chapter  " data-progress="2.2" style="left: 42.30769230769231%;"></a>
    
        <a href="../../md/02/3.html" title="Error Handling" class="chapter  " data-progress="2.3" style="left: 46.15384615384615%;"></a>
    
        <a href="../../md/02/4.html" title="Basic I/O" class="chapter  " data-progress="2.4" style="left: 50%;"></a>
    
        <a href="../../md/02/5.html" title="Example: Secret Sharing" class="chapter  " data-progress="2.5" style="left: 53.84615384615385%;"></a>
    
        <a href="../../md/03.html" title="Multi-Purpose Maps: Structures, Traits, and Higher-Order Functions" class="chapter  new-chapter" data-progress="3" style="left: 57.69230769230769%;"></a>
    
        <a href="../../md/03/1.html" title="Structures" class="chapter  " data-progress="3.1" style="left: 61.53846153846154%;"></a>
    
        <a href="../../md/03/2.html" title="Traits" class="chapter  " data-progress="3.2" style="left: 65.38461538461539%;"></a>
    
        <a href="../../md/03/3.html" title="Higher-Order Functions" class="chapter  " data-progress="3.3" style="left: 69.23076923076923%;"></a>
    
        <a href="../../md/03/4.html" title="Example: Mapping a List" class="chapter  " data-progress="3.4" style="left: 73.07692307692308%;"></a>
    
        <a href="../../md/04.html" title="Tasks and Communication" class="chapter  new-chapter" data-progress="4" style="left: 76.92307692307692%;"></a>
    
        <a href="../../md/04/1.html" title="Task Properties" class="chapter  " data-progress="4.1" style="left: 80.76923076923077%;"></a>
    
        <a href="../../md/04/2.html" title="Example: Multi-Tasking Map" class="chapter  " data-progress="4.2" style="left: 84.61538461538461%;"></a>
    
        <a href="../../md/05.html" title="Concurrency Across Tasks: Arcs and Mutexes" class="chapter  new-chapter" data-progress="5" style="left: 88.46153846153847%;"></a>
    
        <a href="../../md/05/1.html" title="The Arc Module" class="chapter  " data-progress="5.1" style="left: 92.3076923076923%;"></a>
    
        <a href="../../md/05/2.html" title="Using a Mutex" class="chapter  " data-progress="5.2" style="left: 96.15384615384616%;"></a>
    
        <a href="../../md/06.html" title="Bringing It Together: MapReduce in Rust" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_11">
                    
                        <h2 id="memory-management-and-pointers">Memory Management and Pointers</h2>
<h3 id="boxes">Boxes</h3>
<p>The <em>box</em> in Rust is the fundamental abstraction of memory. References in Rust can point to boxes.  Because Rust is designed to emphasize safety, any allocated memory in Rust is <em>boxed</em>, and thus any box can be thought of as simply a chunk of memory. </p>
<h3 id="pointer-types">Pointer Types</h3>
<p>Rust provides two main pointer types: the <em>owned</em> pointer (indicated by the tilde: <code>~</code>) and the <em>borrowed</em> reference (denoted with ampersand: <code>&amp;</code>). Both kinds of pointers point to a box, and the pointer types are in line with the type of data the box contains. For example, <code>~[&amp;str]</code> is a owned reference to a vector of borrowed strings.</p>
<p>Similarly to C or C++, dereferencing a Rust pointer is done with the star operator (<code>*</code>). The next section on ownership will go into more detail on the usage and interaction of both of these.</p>
<div class="note">
Note: Legacy Rust code (before 0.9) also has a &quot;managed pointer&quot; represented by the <code>@</code> which was automatically managed (garbage collected). As of Rust 0.9, this syntax is deprecated, however it is planned to be reintroduced in future releases. These added a deal of simplicity to pointer management, however other pointer types could be used with more efficency.  Automatically managed pointers may be implemented as library types.
</div>

<h3 id="ownership">Ownership</h3>
<p>In Rust, there is a notion of <em>ownership</em> of an object.  The owner of an object, which could be a variable that refers to that object, manages the object&#39;s lifetime (that is, when its memory is allocated and reclaimed).  Programmers do not have to explicitly allocate and deallocate storage.  Rather, it is done by the Rust compiler and runtime enviroment based on how the object references are used.</p>
<h4 id="owned-boxes">Owned Boxes</h4>
<p>A declaration of an owned (<code>~</code>) pointer can be thought of as giving the declared variable ownership of the box.  What does this mean in code? The following block works as anticipated, printing out &quot;10&quot;.</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> x = ~<span class="hljs-number">10</span>;
    println!(<span class="hljs-string">"{:d}"</span>, *x);
</code></pre>
<p>However the following block gives a compilation error:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> x = ~<span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> y = x;
    println!(<span class="hljs-string">"{:d}"</span>, *x);
</code></pre>
<pre><code>tut2.rs:3:23: 3:24 <span style="color:red;">error:</span> use of moved value: `x`
tut2.rs:3     println!("{:d}", *x);
</code></pre>

<p>The error message is a bit unclear, but what it is reporting is a violation of ownership rules.  When we create the owned box of <code>~10</code>, that box is owned by the variable <code>x</code>. The initialization, <code>let y = x;</code> assigns the <em>pointer</em> to y. Because of Rust&#39;s emphasis on safety this is not allowed: it creates two references to an owned box.  </p>
<p>In other languages, such as C and Java, there are no restrictions on pointer sharing.  We could do the following:</p>
<pre><code class="lang-c">    <span class="hljs-comment">//This assignment works in C, not Rust!</span>
    y = x;
    *y = <span class="hljs-number">3</span>;
</code></pre>
<p>This changes the value of <code>*x</code> through the alias.  With Rust, the assignment, <code>y = x</code> transfers ownership of the box <code>x</code> refers to from the <code>x</code> reference to the <code>y</code> reference. From this point on, any attempts to use <code>x</code> to manipulate that box will result in a compilation error.</p>
<p>We can make a copy of a box using the <code>clone()</code> method which copies over the content of a box and creates a new owned pointer to the copy. So the following code will assign <code>y</code> to a new owned pointer pointing to a new copy of the value &quot;10&quot;. The dereferencing of <code>x</code> no longer causes a compiler error, as <code>x</code> still has proper ownership of its box.</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> x = ~<span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> y = x.clone();
    println!(<span class="hljs-string">"{:d}"</span>, *x);
</code></pre>
<p>Keep in mind though, since <code>x</code> and <code>y</code> refer to different boxes now, so a modification of <code>*x</code> will not be visible through <code>y</code>.</p>
<h4 id="borrowed-references">Borrowed References</h4>
<p>As we have seen, to use a box in multiple instances with the <code>~</code> owned pointers, we need to create copies of the box. Also, we can&#39;t access the same box with multiple variables. If we were to exclusively use owned pointers, the copying would be very expensive, and eliminate the benefits of data sharing for uses like pass-by-reference and data structures.  Rust&#39;s solution is to provide a way for box owners to loan out their objects.  </p>
<p>Using the <code>&amp;</code> operator creates a temporary reference to some memory that has already been allocated. These references are refered to as &quot;borrowed&quot; because they can access the contents of the box during the borrowing period, but do not own the box. This most commonly used to pass in a pointer reference to a method.</p>
<p>Because of Rust&#39;s emphasis on safety there are many resctriction on what can be done with a reference. Most notably, if a pointer has a borrowed reference in scope (more on scope in the next section), any function which would free the memory or change the type being pointed to would cause a compile-time error. Think of it this way: creating a reference to a box &quot;lends&quot; that box&#39;s contents to the reference until the loaned box is &quot;returned&quot;.  Thus, a reference owner gives up full control over a loaned box while it is being borrowed.</p>
<p>Borrowed references are frequently used as function parameters.  For example,</p>
<pre><code class="lang-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">borrow</span>(</span>r : &amp;<span class="hljs-keyword">int</span>) -&gt; <span class="hljs-keyword">int</span> {
    *r
}
</code></pre>
<p>declares the function <code>borrow(&amp;int)</code> to take a borrowed pointer to an int.  We can call it by passing in an owned pointer:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> x = box <span class="hljs-number">10</span>;
    println!(<span class="hljs-string">"borrow(x): {:d}"</span>, borrow(x));
</code></pre>
<p>Borrowed pointers can also be loaned by the borrowee, within the lifetime of the original loan.  We can pass in an owned pointer to borrow2, which borrows that pointer and passes it as a borrowed pointer to borrow:</p>
<pre><code class="lang-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">borrow2</span>(</span>r : &amp;<span class="hljs-keyword">int</span>) -&gt; <span class="hljs-keyword">int</span> {
   borrow(r)
}
</code></pre>
<h4 id="pointer-mutability">Pointer Mutability</h4>
<p>As with scalar variables, boxes are immutable by default. The <code>mut</code> qualifier is used to indicate that a box is mutable.  Mutability applies to the <em>contents</em> of a box, and not the pointer itself.</p>
<p>For example,</p>
<pre><code class="lang-rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">increment</span>(</span>r: &amp;<span class="hljs-keyword">int</span>) {
    *r = *r + <span class="hljs-number">1</span>;
}
</code></pre>
<p>is not permitted and returns the following compilation error:</p>
<pre><code>
borrowed.rs:2:4: 2:6 <span style="color:red;">error:</span> cannot assign to immutable dereference of & pointer
borrowed.rs:2     *r = *r + 1;
                   ^~
</code></pre>

<p>To allow the modification, we need to declare the parameter as a borrowed, mutable reference: <code>r: &amp;mut int</code></p>
<p>Now, if we try to pass in a nonmutable reference as the parameter, we will receive a different error. The following code:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> x = ~<span class="hljs-number">10</span>
    increment(x)
</code></pre>
<p>Produces the following error:</p>
<pre><code>
borrowed.rs:16:14: 16:15 <span style="color:red;">error:</span> cannot borrow immutable dereference of ~ pointer as mutable
borrowed.rs:16     increment(x);
</code></pre>

<p>To change this, we need to add <code>mut</code> to the declaration:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> x = box <span class="hljs-number">10</span>;
    increment(x);
</code></pre>
<p>The <code>mut</code> here applies to the reference <code>x</code> and is also inherited by the box (so no separate <code>mut</code> annotation is needed for the <code>~</code>.  It allows both the variable <code>x</code> to be reassigned, as well as the contents of the owned box to be modified:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> x = ~<span class="hljs-number">10</span>;
    x = ~<span class="hljs-number">20</span>;
    *x = <span class="hljs-number">30</span>;
</code></pre>
<p>The first assignment statement creates a new box owned by <code>x</code> holding the value <code>20</code>. The second assignment statement modifies the value in that box to be <code>30</code>.  Without the <code>mut</code>, neither assignment would be permitted by the Rust compiler.</p>
<p>Borrowed references do not inherit mutability.  For example, this code is invalid:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> val1 = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> val2 = <span class="hljs-number">20</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> borrowed = &amp;val1;
    borrowed = &amp;val2;
    *borrowed = <span class="hljs-number">11</span>;
</code></pre>
<pre><code>
borrowed.rs:23:4: 23:13 <span style="color:red;">error:</span> cannot assign to immutable dereference of & pointer
borrowed.rs:23     *borrowed = 11;
                   <span style="color:red;">^~~~~~~~~</span>
</code></pre>

<p>To allow both modifications, we need the following:</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> borrowed = &amp;<span class="hljs-keyword">mut</span> val1;
</code></pre>
<p>This allows both modifying the referenced box and changing what <code>borrowed</code> references. </p>
<p>Keep in mind that references are type checked (yet another safety measure of Rust!) so the following code produces an error at compile time due to trying to reassign an int reference to a float reference.</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> val1 = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> val3 = <span class="hljs-number">10.0</span>;
    <span class="hljs-keyword">let</span> borrowed = &amp;val1;
    borrowed = &amp;val3;
</code></pre>
<pre><code>tut2.rs:4:16: 6:21 <span style="color:red;">error:</span> mismatched types: expected `&&lt;VI0&gt;` but found `&&lt;VF0&gt;` (expected integral variable but found floating-point variable)
tut2.rs:4     borrowed = &val3;
</code></pre>

<h4 id="freezing-objects">Freezing Objects</h4>
<p>When an object is loaned through a borrowed reference, the lender loses the ability to modify that object. This is especially important for
multi-tasking (which we&#39;ll get to soon), but still relevant with a single thread.</p>
<p>For example, the following program produces a compiler error: </p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> x = <span class="hljs-number">10</span>;
    {
        <span class="hljs-keyword">let</span> y = &amp;x;
        x = <span class="hljs-number">11</span>; <span class="hljs-comment">// Error</span>
    }
    x = <span class="hljs-number">12</span>; <span class="hljs-comment">//This is fine</span>
</code></pre>
<pre><code>example.rs:4:9: 4:10 <span style="color:red;">error:</span> cannot assign to `x` because it is borrowed
example.rs:4         x = 11;
</code></pre>

<p>When the reference <code>y</code> borrows the value <code>x</code> refers to, the value of <code>x</code> is frozen until the reference to it goes out of scope. Thus, the first reassignment here is invalid, but the second (after <code>y</code> is out of scope) is fine.</p>
<h3 id="lifetimes">Lifetimes</h3>
<p>Memory allocated in Rust is automatically freed when its owner either goes out of scope or is reassigned. This eliminates the need to explicitly free storage (as in C or C++), but guarantees safety without giving up control to an expensive garbage collector.  </p>
<p>Owned pointers follow similar rules of deallocation, so borrowing a reference to some box and trying to access it once it has gone out of scope throws a compiler error.</p>
<pre><code class="lang-rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> reference: &amp;~<span class="hljs-keyword">int</span>;
    {
        <span class="hljs-keyword">let</span> val: ~<span class="hljs-keyword">int</span> = ~<span class="hljs-number">10</span>;
        reference = &amp;val;
    } <span class="hljs-comment">//val deallocated here</span>
    println!(<span class="hljs-string">"{:d}"</span>, **reference); <span class="hljs-comment">//Referencing something that's gone!</span>
</code></pre>
<pre><code>example.rs:4:21: 4:25 <span style="color:red;">error:</span> borrowed value does not live long enough
example.rs:4         reference = &val;
</code></pre>


                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../../md/02.html" class="navigation navigation-prev " aria-label="Previous page: Starting to Corrode: Pointers, Memory, Strings, and I/O"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../md/02/2.html" class="navigation navigation-next " aria-label="Next page: Vectors and Strings"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../../gitbook/app.js"></script>
        

    
    <script src="../../gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
