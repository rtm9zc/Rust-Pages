<!DOCTYPE HTML>
<html lang="en-US" manifest="../../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Example: Secret Sharing | Rust in Seven Programs</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="rtm9zc">
        <meta name="description" content="A Tutorial to the Rust programming language">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../../md/03.html" />
        
        
        <link rel="prev" href="../../md/02/4.html" />
        

        <meta property="og:title" content="Example: Secret Sharing | Rust in Seven Programs">
        <meta property="og:site_name" content="Rust in Seven Programs">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/rtm9zc">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="../../gitbook/style.css">
        


        
    <div class="book" data-github="rtm9zc/Rust-Pages" data-level="2.5" data-basepath="../.." data-revision="1401726962514">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/rtm9zc/Rust-Pages" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/rtm9zc/Rust-Pages/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/rtm9zc/Rust-Pages/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../../" >Rust in Seven Programs</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/rtm9zc" target="blank" class="author-link">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/rtm9zc/Rust-Pages/issues" target="blank"class="issues-link">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/rtm9zc/Rust-Pages/edit/master/md/02/5.md" target="blank" class="contribute-link">Edit and Contribute</a>
        </li>
        

        

        <li data-level="0" data-path="index.html">
            <a href="../../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li class="chapter " data-level="1" data-path="md/01.html">
                
                <a href="../../md/01.html">
                    <i class="fa fa-check"></i> <b>1.</b> Getting Started: Variables, Functions, and Syntax
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="md/01/1.html">
                            
                            <a href="../../md/01/1.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> Variables
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="md/01/2.html">
                            
                            <a href="../../md/01/2.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> Conditionals
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="md/01/3.html">
                            
                            <a href="../../md/01/3.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> Pattern Matching
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.4" data-path="md/01/4.html">
                            
                            <a href="../../md/01/4.html">
                                <i class="fa fa-check"></i> <b>1.4.</b> Looping
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.5" data-path="md/01/5.html">
                            
                            <a href="../../md/01/5.html">
                                <i class="fa fa-check"></i> <b>1.5.</b> Expressions
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.6" data-path="md/01/6.html">
                            
                            <a href="../../md/01/6.html">
                                <i class="fa fa-check"></i> <b>1.6.</b> Functions
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.7" data-path="md/01/7.html">
                            
                            <a href="../../md/01/7.html">
                                <i class="fa fa-check"></i> <b>1.7.</b> Program 1: Collatz
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="2" data-path="md/02.html">
                
                <a href="../../md/02.html">
                    <i class="fa fa-check"></i> <b>2.</b> Starting to Corrode: Pointers, Memory, Strings, and I/O
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="md/02/1.html">
                            
                            <a href="../../md/02/1.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Memory Management and Pointers
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="md/02/2.html">
                            
                            <a href="../../md/02/2.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> Vectors and Strings
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="md/02/3.html">
                            
                            <a href="../../md/02/3.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> Error Handling
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="md/02/4.html">
                            
                            <a href="../../md/02/4.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Basic I/O
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="md/02/5.html">
                            
                            <a href="../../md/02/5.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Example: Secret Sharing
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="3" data-path="md/03.html">
                
                <a href="../../md/03.html">
                    <i class="fa fa-check"></i> <b>3.</b> Multi-Purpose Maps: Structures, Traits, and Higher-Order Functions
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="md/03/1.html">
                            
                            <a href="../../md/03/1.html">
                                <i class="fa fa-check"></i> <b>3.1.</b> Structures
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="md/03/2.html">
                            
                            <a href="../../md/03/2.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> Traits
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="md/03/3.html">
                            
                            <a href="../../md/03/3.html">
                                <i class="fa fa-check"></i> <b>3.3.</b> Higher-Order Functions
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="md/03/4.html">
                            
                            <a href="../../md/03/4.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> Example: Mapping a List
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="4" data-path="md/04.html">
                
                <a href="../../md/04.html">
                    <i class="fa fa-check"></i> <b>4.</b> Tasks and Communication
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" data-path="md/04/1.html">
                            
                            <a href="../../md/04/1.html">
                                <i class="fa fa-check"></i> <b>4.1.</b> Task Properties
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="md/04/2.html">
                            
                            <a href="../../md/04/2.html">
                                <i class="fa fa-check"></i> <b>4.2.</b> Example: Multi-Tasking Map
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li class="chapter " data-level="5" data-path="md/05.html">
                
                <a href="../../md/05.html">
                    <i class="fa fa-check"></i> <b>5.</b> Arcs and Sharing Memory
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="md/05/1.html">
                            
                            <a href="../../md/05/1.html">
                                <i class="fa fa-check"></i> <b>5.1.</b> The Arc Module
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 58.333333333333336%;min-width: 54.166666666666664%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../../md/01.html" title="Getting Started: Variables, Functions, and Syntax" class="chapter done new-chapter" data-progress="1" style="left: 4.166666666666667%;"></a>
    
        <a href="../../md/01/1.html" title="Variables" class="chapter done " data-progress="1.1" style="left: 8.333333333333334%;"></a>
    
        <a href="../../md/01/2.html" title="Conditionals" class="chapter done " data-progress="1.2" style="left: 12.5%;"></a>
    
        <a href="../../md/01/3.html" title="Pattern Matching" class="chapter done " data-progress="1.3" style="left: 16.666666666666668%;"></a>
    
        <a href="../../md/01/4.html" title="Looping" class="chapter done " data-progress="1.4" style="left: 20.833333333333332%;"></a>
    
        <a href="../../md/01/5.html" title="Expressions" class="chapter done " data-progress="1.5" style="left: 25%;"></a>
    
        <a href="../../md/01/6.html" title="Functions" class="chapter done " data-progress="1.6" style="left: 29.166666666666668%;"></a>
    
        <a href="../../md/01/7.html" title="Program 1: Collatz" class="chapter done " data-progress="1.7" style="left: 33.333333333333336%;"></a>
    
        <a href="../../md/02.html" title="Starting to Corrode: Pointers, Memory, Strings, and I/O" class="chapter done new-chapter" data-progress="2" style="left: 37.5%;"></a>
    
        <a href="../../md/02/1.html" title="Memory Management and Pointers" class="chapter done " data-progress="2.1" style="left: 41.666666666666664%;"></a>
    
        <a href="../../md/02/2.html" title="Vectors and Strings" class="chapter done " data-progress="2.2" style="left: 45.833333333333336%;"></a>
    
        <a href="../../md/02/3.html" title="Error Handling" class="chapter done " data-progress="2.3" style="left: 50%;"></a>
    
        <a href="../../md/02/4.html" title="Basic I/O" class="chapter done " data-progress="2.4" style="left: 54.166666666666664%;"></a>
    
        <a href="../../md/02/5.html" title="Example: Secret Sharing" class="chapter done " data-progress="2.5" style="left: 58.333333333333336%;"></a>
    
        <a href="../../md/03.html" title="Multi-Purpose Maps: Structures, Traits, and Higher-Order Functions" class="chapter  new-chapter" data-progress="3" style="left: 62.5%;"></a>
    
        <a href="../../md/03/1.html" title="Structures" class="chapter  " data-progress="3.1" style="left: 66.66666666666667%;"></a>
    
        <a href="../../md/03/2.html" title="Traits" class="chapter  " data-progress="3.2" style="left: 70.83333333333333%;"></a>
    
        <a href="../../md/03/3.html" title="Higher-Order Functions" class="chapter  " data-progress="3.3" style="left: 75%;"></a>
    
        <a href="../../md/03/4.html" title="Example: Mapping a List" class="chapter  " data-progress="3.4" style="left: 79.16666666666667%;"></a>
    
        <a href="../../md/04.html" title="Tasks and Communication" class="chapter  new-chapter" data-progress="4" style="left: 83.33333333333333%;"></a>
    
        <a href="../../md/04/1.html" title="Task Properties" class="chapter  " data-progress="4.1" style="left: 87.5%;"></a>
    
        <a href="../../md/04/2.html" title="Example: Multi-Tasking Map" class="chapter  " data-progress="4.2" style="left: 91.66666666666667%;"></a>
    
        <a href="../../md/05.html" title="Arcs and Sharing Memory" class="chapter  new-chapter" data-progress="5" style="left: 95.83333333333333%;"></a>
    
        <a href="../../md/05/1.html" title="The Arc Module" class="chapter  " data-progress="5.1" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_15">
                    
                        <h2 id="example-secret-sharing">Example: Secret Sharing</h2>
<p>The XOR operation is a simple, but effective method for hiding meaning. It&#39;s derived from the identity <code>A = (A ^ B) ^ B</code>.  XOR-ing a message with a random key provides <em>perfect</em> encryption, known as a <em>one-time pad</em>. It is essentially the only form of encryption
that is information-theoretically secure, but is impractical for most purposes since it requires a perfectly-random key as long as the message and that key can never be reused.</p>
<p>It works by taking in a message and a random bit sequence (key) of equal length. Each bit in the message is XORed with the corresponding bit in the key to produce the encrypted message. The original message can then be recovered by applying the XOR process to the key and the encrypted message.</p>
<p>For this exercise, we will use this strategy to convert a plaintext file into two secret shares, each of which discloses no information about the original file (other than its length), but if someone has both shares they can put them together to produce the original file.  A paranoid individual might use such an approach to store a file in the cloud by storing one share using Dropbox and the other share using Google Docs. The user could acquire both shares to obtain the file, and if the NSA can hypothetically (of course) obtain all of the data from one of the services but not both of them, it would not be enough to learn the contents of the file.</p>
<p>Note that our implementation uses <code>td::rand::random</code> o generate the random key.  This is not cryptographically strong randomness, so should be used for entertainment purposes only!  (If you are interested in better random numbers, see <a href="https://github.com/wbkostan/cs4414-ps4">tRustees: True Random Number Generation</a>.)</p>
<p>We&#39;ll provide the code to do the splitting, and leave it as an exercise for you to write the joining code.</p>
<h3 id="splitter">Splitter</h3>
<p>The following Rust code implements the splitter. It takes as input the name of a file, and writes out two share files.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">use</span> std::rand::random;
<span class="hljs-keyword">use</span> std::os;
<span class="hljs-keyword">use</span> std::io::File;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span>(</span>) {
    <span class="hljs-keyword">let</span> args: ~[~<span class="hljs-keyword">str</span>] = os::args();
    <span class="hljs-keyword">if</span> args.len() != <span class="hljs-number">2</span> {
        println!(<span class="hljs-string">"Usage: {:s} &lt;inputfile&gt;"</span>, args[<span class="hljs-number">0</span>]); 
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> fname = args[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">let</span> path = Path::new(fname.clone());
        <span class="hljs-keyword">let</span> msg_file = File::open(&amp;path);

        <span class="hljs-keyword">match</span> (msg_file) {
            Some(<span class="hljs-keyword">mut</span> msg) =&gt; {
                <span class="hljs-keyword">let</span> msg_bytes: ~[<span class="hljs-keyword">u8</span>] = msg.read_to_end();
                <span class="hljs-keyword">let</span> share1_file 
                       = File::create(&amp;Path::new(fname + <span class="hljs-string">".share1"</span>));
                <span class="hljs-keyword">let</span> share2_file 
                       = File::create(&amp;Path::new(fname + <span class="hljs-string">".share2"</span>));

                <span class="hljs-keyword">match</span> (share1_file, share2_file) {
                    (Some(share1), Some(share2)) =&gt; { 
                        split(msg_bytes, share1, share2); 
                        } ,
                    (<span class="hljs-number">_</span>, <span class="hljs-number">_</span>) =&gt; <span class="hljs-keyword">fail</span>!(<span class="hljs-string">"Error opening output files!"</span>),
                }
            } ,
            None =&gt; <span class="hljs-keyword">fail</span>!(<span class="hljs-string">"Error opening message file: {:s}"</span>, fname)
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">xor</span>(</span>a: &amp;[<span class="hljs-keyword">u8</span>], b: &amp;[<span class="hljs-keyword">u8</span>]) -&gt; ~[<span class="hljs-keyword">u8</span>] {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> ret = ~[];
    <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">0</span>, a.len()) {
    ret.push(a[i] ^ b[i]);
    }
    ret
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">split</span>(</span>msg_bytes: &amp;[<span class="hljs-keyword">u8</span>], <span class="hljs-keyword">mut</span> share1: File, <span class="hljs-keyword">mut</span> share2: File) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> random_bytes: ~[<span class="hljs-keyword">u8</span>] = ~[];
    <span class="hljs-comment">// This is not cryptographically strong randomness! </span>
    <span class="hljs-comment">// (For entertainment purposes only.)</span>
    <span class="hljs-keyword">for</span> <span class="hljs-number">_</span> in range(<span class="hljs-number">0</span>, msg_bytes.len()) {
    <span class="hljs-keyword">let</span> random_byte = random();
    random_bytes.push(random_byte);
    }

    <span class="hljs-keyword">let</span> encrypted_bytes = xor(msg_bytes, random_bytes);
    share1.write(random_bytes);
    share2.write(encrypted_bytes);
}
</code></pre>
<h4 id="joiner">Joiner</h4>
<p>The joiner reverses the splitting process, taking the two shares and combining them to produce the original message.</p>
<blockquote>
<p><strong>Exercise 2.3.</strong> Implement the joiner.  It should take two file names as its inputs, and output to standard output the result of XOR-ing the bytes in those files. The input files must be the same length.</p>
</blockquote>
<p>Your joiner should be able to produce the plaintext from the example
files: <a href="http://rtm9zc.github.io/Rust-Pages/code/msg.share1">msg.share1</a> and <a href="http://rtm9zc.github.io/Rust-Pages/code/msg.share2">msg.share2</a>.  You should download these files (look at them to confirm they appear to be random bytes).  </p>
<p>Then, try executing:</p>
<pre><code>
joiner msg.share1 msg.share2
</code>
</pre>

<p>If you implemented the joiner correctly, you should see a (somewhat) <a href="http://www.gutenberg.org/cache/epub/1518/pg1518.html">meaningful message</a>.</p>
<div class="credits">
This tutorial was created by Alex&nbsp;Lamana, Rob&nbsp;Michaels, Wil&nbsp;Thomason, and David&nbsp;Evans for <a href="http://rust-class.org">University of Virginia cs4414 Spring 2014</a>.
</div>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../../md/02/4.html" class="navigation navigation-prev " aria-label="Previous page: Basic I/O"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../md/03.html" class="navigation navigation-next " aria-label="Next page: Multi-Purpose Maps: Structures, Traits, and Higher-Order Functions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../../gitbook/app.js"></script>
        

    
    <script src="../../gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
